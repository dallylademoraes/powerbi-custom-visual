var patProgressVisual346D42228CB8402E8C6F55126CCEF34A;(()=>{"use strict";var e={413(e,t,i){i.d(t,{S:()=>o});var a=i(674),s=a.z.Tn,n=a.z.Kx;class l extends s{defaultColor=new a.z.sk({name:"defaultColor",displayName:"Default color",value:{value:""}});showAllDataPoints=new a.z.jF({name:"showAllDataPoints",displayName:"Show all",value:!0});fill=new a.z.sk({name:"fill",displayName:"Fill",value:{value:""}});fillRule=new a.z.sk({name:"fillRule",displayName:"Color saturation",value:{value:""}});fontSize=new a.z.iB({name:"fontSize",displayName:"Text Size",value:12});name="dataPoint";displayName="Data colors";slices=[this.defaultColor,this.showAllDataPoints,this.fill,this.fillRule,this.fontSize]}class o extends n{dataPointCard=new l;cards=[this.dataPointCard]}},639(e,t,i){function a(e,t){return{objectName:e,propertyName:t.name,selector:t.selector,altConstantValueSelector:t.altConstantSelector,instanceKind:t.instanceKind}}function s(e,t,i){return null==t||"object"==typeof t&&!t.solid?i:t.solid?{value:null==t?void 0:t.solid.color}:"Dropdown"===(null==e?void 0:e.type)&&e.items?e.items.find(e=>e.value==t):t}i.d(t,{D:()=>s,y:()=>a})},667(e,t,i){i.d(t,{A:()=>s});var a=i(754);const s=class{constructor(e){this.localizationManager=e}populateFormattingSettingsModel(e,t){var i,s;const n=new e,l=null===(i=null==t?void 0:t.metadata)||void 0===i?void 0:i.objects;return l&&(null===(s=n.cards)||void 0===s||s.forEach(e=>{var t;e instanceof a.St&&(null===(t=e.topLevelSlice)||void 0===t||t.setPropertiesValues(l,e.name)),(e instanceof a.Tn?[e]:e.groups).forEach(t=>{var i,a,s,n;null===(i=t.topLevelSlice)||void 0===i||i.setPropertiesValues(l,e.name),null===(a=null==t?void 0:t.slices)||void 0===a||a.forEach(t=>{null==t||t.setPropertiesValues(l,e.name)}),null===(n=null===(s=null==t?void 0:t.container)||void 0===s?void 0:s.containerItems)||void 0===n||n.forEach(t=>{var i;null===(i=null==t?void 0:t.slices)||void 0===i||i.forEach(t=>{null==t||t.setPropertiesValues(l,e.name)})})})})),n}buildFormattingModel(e){const t={cards:[]};return e.cards.filter(({visible:e=!0})=>e).forEach(e=>{var i;const s={displayName:this.localizationManager&&e.displayNameKey?this.localizationManager.getDisplayName(e.displayNameKey):e.displayName,description:this.localizationManager&&e.descriptionKey?this.localizationManager.getDisplayName(e.descriptionKey):e.description,groups:[],uid:e.name+"-card",analyticsPane:e.analyticsPane},n=e.name;if(e.topLevelSlice){const t=e.topLevelSlice.getFormattingSlice(n,this.localizationManager);t.suppressDisplayName=!0,s.topLevelToggle=t}null===(i=e.onPreProcess)||void 0===i||i.call(e);const l=e instanceof a.Tn;(l?[e].filter(({visible:e=!0})=>e):e.groups.filter(({visible:e=!0})=>e)).forEach(e=>{const t=e.name+"-group",i={displayName:l?void 0:this.localizationManager&&e.displayNameKey?this.localizationManager.getDisplayName(e.displayNameKey):e.displayName,description:l?void 0:this.localizationManager&&e.descriptionKey?this.localizationManager.getDisplayName(e.descriptionKey):e.description,slices:[],uid:t,collapsible:e.collapsible,delaySaveSlices:e.delaySaveSlices,disabled:e.disabled,disabledReason:e.disabledReason};s.groups.push(i);const a={};if(e.container){const s=e.container,l=t+"-container",o={displayName:this.localizationManager&&s.displayNameKey?this.localizationManager.getDisplayName(s.displayNameKey):s.displayName,description:this.localizationManager&&s.descriptionKey?this.localizationManager.getDisplayName(s.descriptionKey):s.description,containerItems:[],uid:l};s.containerItems.forEach(e=>{const t=e.displayNameKey?e.displayNameKey:e.displayName,i=l+t,s={displayName:this.localizationManager&&e.displayNameKey?this.localizationManager.getDisplayName(e.displayNameKey):e.displayName,slices:[],uid:i};this.buildFormattingSlices({slices:e.slices,objectName:n,sliceNames:a,formattingSlices:s.slices}),o.containerItems.push(s)}),i.container=o}if(e.slices){if(e.topLevelSlice){const t=e.topLevelSlice.getFormattingSlice(n,this.localizationManager);t.suppressDisplayName=!0,(null==i.displayName?s:i).topLevelToggle=t}this.buildFormattingSlices({slices:e.slices,objectName:n,sliceNames:a,formattingSlices:i.slices})}}),s.revertToDefaultDescriptors=this.getRevertToDefaultDescriptor(e),t.cards.push(s)}),t}buildFormattingSlices({slices:e,objectName:t,sliceNames:i,formattingSlices:a}){null==e||e.filter(({visible:e=!0})=>e).forEach(e=>{const s=null==e?void 0:e.getFormattingSlice(t,this.localizationManager);s&&(void 0===i[e.name]?i[e.name]=0:(i[e.name]++,s.uid=`${s.uid}-${i[e.name]}`),a.push(s))})}getRevertToDefaultDescriptor(e){var t;const i={},s=[];let n,l=[];return e instanceof a.St&&e.topLevelSlice&&s.push(...null===(t=e.topLevelSlice)||void 0===t?void 0:t.getRevertToDefaultDescriptor(e.name)),(e instanceof a.Tn?[e].filter(({visible:e=!0})=>e):e.groups.filter(({visible:e=!0})=>e)).forEach(t=>{var a,o;n=this.getSlicesRevertToDefaultDescriptor(e.name,t.slices,i,t.topLevelSlice),null===(o=null===(a=t.container)||void 0===a?void 0:a.containerItems)||void 0===o||o.forEach(t=>{l=l.concat(this.getSlicesRevertToDefaultDescriptor(e.name,t.slices,i))}),s.push(...n.concat(l))}),s}getSlicesRevertToDefaultDescriptor(e,t,i,a){let s=[];return a&&(i[a.name]=!0,s=s.concat(a.getRevertToDefaultDescriptor(e))),null==t||t.forEach(t=>{t&&!i[t.name]&&(i[t.name]=!0,s=s.concat(t.getRevertToDefaultDescriptor(e)))}),s}}},674(e,t,i){i.d(t,{O:()=>s.A,z:()=>a});var a=i(754),s=i(667)},754(e,t,i){i.d(t,{Kx:()=>l,St:()=>o,Tn:()=>r,iB:()=>p,jF:()=>d,sk:()=>u});var a=i(639);class s{}class n extends s{}class l{}class o extends s{}class r extends n{}class c extends s{constructor(e){super(),Object.assign(this,e)}getFormattingSlice(e,t){const i=this.type,a=this.name,s={displayName:t&&this.displayNameKey?t.getDisplayName(this.displayNameKey):this.displayName,description:t&&this.descriptionKey?t.getDisplayName(this.descriptionKey):this.description,uid:e+"-"+a};return Object.assign(Object.assign({},s),{control:{type:i,properties:this.getFormattingComponent(e,t)}})}getFormattingComponent(e,t){return{descriptor:a.y(e,this),value:this.value}}getRevertToDefaultDescriptor(e){return[{objectName:e,propertyName:this.name}]}setPropertiesValues(e,t){var i;const s=null===(i=null==e?void 0:e[t])||void 0===i?void 0:i[this.name];this.value=a.D(this,s,this.value)}}class d extends c{constructor(e){super(e),this.type="ToggleSwitch"}}class u extends c{constructor(e){super(e),this.type="ColorPicker"}getFormattingComponent(e){return Object.assign(Object.assign({},super.getFormattingComponent(e)),{defaultColor:this.defaultColor,isNoFillItemSupported:this.isNoFillItemSupported})}}class p extends c{constructor(e){super(e),this.type="NumUpDown"}getFormattingComponent(e){return Object.assign(Object.assign({},super.getFormattingComponent(e)),{options:this.options})}}},820(e,t,i){i.d(t,{b:()=>n});var a=i(674),s=i(413);class n{target;formattingSettings;formattingSettingsService;host;constructor(e){console.log("Visual constructor",e),this.formattingSettingsService=new a.O,this.host=e.host,this.target=e.element}update(e){this.target.innerHTML="";const t=e.dataViews?.[0],i=t?.categorical;if(!i?.categories||i.categories.length<2)return void(this.target.innerHTML="Arraste campos para Eixo + (Ano/MÃªs) ou Eixo + (Data inicial/Data final).");this.formattingSettings=this.formattingSettingsService.populateFormattingSettingsModel(s.S,t);const a=i.categories??[],n=a.find(e=>e.source?.roles?.eixo)??a[0],l=a.find(e=>e.source?.roles?.ano),o=a.find(e=>e.source?.roles?.mes),r=a.find(e=>e.source?.roles?.inicio),c=a.find(e=>e.source?.roles?.fim);if(!n||!(l||o||r&&c))return void(this.target.innerHTML="Arraste campos para Eixo + (Ano/MÃªs) ou Eixo + (Data inicial/Data final).");const d=n.values.map(e=>String(e??"")),u=(l?.values??[]).map(e=>String(e??"")),p=(o?.values??[]).map(e=>String(e??"")),m=r?.values??[],g=c?.values??[],y=void 0!==o&&p.length>0,h=(void 0!==l&&u.length,void 0!==r&&void 0!==c&&m.length>0&&g.length>0),f=i.values?.[0]?.values?.map(e=>Number(e))??[],v=new Map,b=new Map,S=new Map,N=new Map,x=new Map,C=new Map;function M(e,t){return`${e}||${t}`}function D(e){if(e instanceof Date)return Number.isNaN(e.getTime())?null:e;const t=new Date(e);return Number.isNaN(t.getTime())?null:t}for(let e=0;e<d.length;e++){const t=d[e],i=u[e]??"",a=p[e]??"",s=y?a:i;if(h){const i=D(m[e]),a=D(g[e]);if(i&&a){const e=x.get(t),s=C.get(t);(!e||i<e)&&x.set(t,i),(!s||a>s)&&C.set(t,a)}}const n=f[e];if(!Number.isNaN(n)){v.set(t,(v.get(t)??0)+n),b.set(t,(b.get(t)??0)+1);const e=M(t,s);S.set(e,(S.get(e)??0)+n),N.set(e,(N.get(e)??0)+1)}}const E=Array.from(new Set(d)).map(e=>e.trim()).filter(e=>e.length>0).sort((e,t)=>e.localeCompare(t,void 0,{numeric:!0,sensitivity:"base"})),w=Array.from(new Set(u)).map(e=>e.trim()).filter(e=>e.length>0).sort((e,t)=>{const i=Number(e),a=Number(t),s=Number.isFinite(i),n=Number.isFinite(a);return s&&n?i-a:s?-1:n?1:e.localeCompare(t,void 0,{numeric:!0,sensitivity:"base"})});function z(e){const t=(e??"").trim().toLowerCase();if(!t)return null;const i=Number(t);if(Number.isFinite(i)&&i>=1&&i<=12)return i;const a=Number(t.replace(/^0+/,""));if(Number.isFinite(a)&&a>=1&&a<=12)return a;const s=[["jan","janeiro","january"],["fev","fevereiro","feb","february"],["mar","marÃ§o","marco","march"],["abr","abril","apr","april"],["mai","maio","may"],["jun","junho","june"],["jul","julho","july"],["ago","agosto","aug","august"],["set","setembro","sep","september"],["out","outubro","oct","october"],["nov","novembro","november"],["dez","dezembro","dec","december"]];for(let e=0;e<s.length;e++)if(s[e].some(e=>t.startsWith(e)))return e+1;return null}const F=h?["M1","M2","M3","M4","M5","M6","M7","M8","M9","M10","M11","M12"]:y?Array.from(new Set(p)).map(e=>e.trim()).filter(e=>e.length>0).sort((e,t)=>{const i=z(e),a=z(t);return null!==i&&null!==a?i-a:null!==i?-1:null!==a?1:e.localeCompare(t,void 0,{numeric:!0,sensitivity:"base"})}):w;if(!h&&y&&w.length>1)return void(this.target.innerHTML="Para visualizar por mÃªs, filtre para um Ãºnico ano (ou remova o campo Ano).");function T(e,t){const i=["#0F766E","#2563EB","#7C3AED","#D97706","#DC2626"];return i[t%i.length]}function $(e){return e<=1?100*e:e}function P(e){return null===e?"â€”":`${$(e).toFixed(2)}%`}function j(e,t){const i=e.replace("#","").trim(),a=3===i.length?`${i[0]}${i[0]}${i[1]}${i[1]}${i[2]}${i[2]}`:i;if(6!==a.length)return e;const s=parseInt(a.slice(0,2),16),n=parseInt(a.slice(2,4),16),l=parseInt(a.slice(4,6),16),o=Math.max(0,Math.min(1,t)),r=Math.round(s+(255-s)*o),c=Math.round(n+(255-n)*o),d=Math.round(l+(255-l)*o),u=e=>e.toString(16).padStart(2,"0");return`#${u(r)}${u(c)}${u(d)}`}function K(e){return e>=85?0:e>=70?.35:.65}const A=document.createElement("div");A.style.fontFamily="Segoe UI",A.style.padding="18px",A.style.boxSizing="border-box";const L=Math.max(10,this.formattingSettings?.dataPointCard?.fontSize?.value??12);for(const e of E){const t=v.get(e)??0,i=b.get(e)??0,a=i>0?t/i:null,s=document.createElement("div");s.style.display="grid",s.style.gridTemplateColumns="90px 110px 1fr 56px",s.style.alignItems="center",s.style.gap="12px",s.style.margin="14px 0";const n=document.createElement("div");n.textContent=e,n.style.fontWeight="700",n.style.fontSize=`${L}px`,n.style.color="#222";const l=document.createElement("div");l.textContent=P(a),l.style.fontWeight="700",l.style.fontSize=`${L}px`,l.style.color="#222";const o=document.createElement("div");o.style.display="flex",o.style.flexDirection="column",o.style.gap="6px";const r=document.createElement("div");r.style.display="flex",r.style.width="100%",r.style.height="36px",r.style.borderRadius="10px",r.style.overflow="hidden",r.style.border="1px solid #ddd",r.style.position="relative";let c=-1;if(h){const t=x.get(e),i=C.get(e);if(!t||!i||i.getTime()<=t.getTime())F.forEach((e,t)=>{const i=document.createElement("div");i.style.flex="1",i.style.background="#f1f3f5",r.appendChild(i)});else{F.forEach((t,i)=>{const a=document.createElement("div");a.style.flex="1",a.style.background=i%2==0?"#eef2f7":"#e6edf6",a.title=`${e} - ${t}`,r.appendChild(a)});const s=null===a?0:Math.max(0,Math.min(100,$(a))),n=Math.round(s/100*F.length);c=Math.max(-1,n-1);const l=document.createElement("div");l.style.position="absolute",l.style.left="0",l.style.top="0",l.style.bottom="0",l.style.width=n/F.length*100+"%",l.style.background=j(T.call(this,"progress",0),K(s)),l.style.opacity="0.95",l.style.pointerEvents="none",r.appendChild(l),r.title=`${e}: ${t.toLocaleDateString()} â†’ ${i.toLocaleDateString()} (${s.toFixed(0)}%)`}}else F.forEach((t,i)=>{const a=document.createElement("div");a.style.flex="1",a.title=`${e} - ${t}`;const s=M(e,t),n=N.get(s)??0;if(n>0){c=Math.max(c,i);const l=(S.get(s)??0)/n,o=$(l),r=T.call(this,t,i);a.style.background=j(r,K(o)),a.title=`${e} - ${t}: ${P(l)}`}else a.style.background="#f1f3f5",a.title=`${e} - ${t}: sem valor`;r.appendChild(a)});const d=c>=0?c+1:-1;if(d>=0&&d<F.length){const e=document.createElement("div");e.style.position="absolute",e.style.top="0",e.style.bottom="0",e.style.left=d/F.length*100+"%",e.style.width="3px",e.style.background="#111",e.style.opacity="0.55",e.style.pointerEvents="none",e.title=h||y?`PrÃ³ximo mÃªs: ${F[d]}`:`PrÃ³ximo ano: ${F[d]}`,r.appendChild(e)}o.appendChild(r);const u=document.createElement("div");if(null===a)u.textContent="ðŸ˜¶";else{const e=$(a);u.textContent=e>=85?"ðŸ˜„":e>=70?"ðŸ™‚":"ðŸ˜"}u.style.fontSize=`${Math.round(2.1*L)}px`,u.style.textAlign="center",u.style.lineHeight="1",s.appendChild(n),s.appendChild(l),s.appendChild(o),s.appendChild(u),A.appendChild(s)}const R=document.createElement("div");R.style.display="grid",R.style.gridTemplateColumns="90px 110px 1fr 56px",R.style.alignItems="center",R.style.gap="12px",R.style.marginTop="8px",R.appendChild(document.createElement("div")),R.appendChild(document.createElement("div"));const V=document.createElement("div");V.style.display="flex",V.style.width="100%",V.style.color="#666",V.style.fontSize=`${Math.max(10,L-1)}px`,V.style.userSelect="none",F.forEach(e=>{const t=document.createElement("div");t.textContent=e,t.style.flex="1",t.style.textAlign="center",V.appendChild(t)}),R.appendChild(V),R.appendChild(document.createElement("div")),A.appendChild(R),this.target.appendChild(A)}getFormattingModel(){return this.formattingSettingsService.buildFormattingModel(this.formattingSettings)}}}},t={};function i(a){var s=t[a];if(void 0!==s)return s.exports;var n=t[a]={exports:{}};return e[a](n,n.exports,i),n.exports}i.d=(e,t)=>{for(var a in t)i.o(t,a)&&!i.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),i.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var a={};(()=>{i.r(a),i.d(a,{default:()=>n});var e=i(820),t=window.powerbi,s={name:"patProgressVisual346D42228CB8402E8C6F55126CCEF34A",displayName:"PAT Progress Visual",class:"Visual",apiVersion:"5.3.0",create:t=>{if(e.b)return new e.b(t);throw"Visual instance not found"},createModalDialog:(e,t,i)=>{const a=globalThis.dialogRegistry;e in a&&new a[e](t,i)},custom:!0};void 0!==t&&(t.visuals=t.visuals||{},t.visuals.plugins=t.visuals.plugins||{},t.visuals.plugins.patProgressVisual346D42228CB8402E8C6F55126CCEF34A=s);const n=s})(),patProgressVisual346D42228CB8402E8C6F55126CCEF34A=a})();